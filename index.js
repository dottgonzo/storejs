var merge = require("json-add");
var los = require("linux-online-status");
function TimeNow() {
    return new Date().getTime();
}
function objectessentials(obj, serial) {
    if (!obj.updatedAt) {
        obj.updatedAt = TimeNow();
    }
    if (!obj.serial) {
        obj.serial = serial;
    }
    return obj;
}
module.exports = (function () {
    function StoreApi(components, serial, timezone) {
        this.components = [];
        if (!components) {
            throw Error("missing object");
        }
        else if (!serial) {
            throw Error("missing uid");
        }
        if (!timezone) {
            this.timezone = "Europe/London";
        }
        else {
            this.timezone = timezone;
        }
        this.serial = serial;
        this.components = components;
        var sys = this.system;
        los().then(function (data) {
            sys = data;
        }).catch(function (err) {
            console.log("linux-online-status error:", err);
        });
    }
    StoreApi.prototype.status = function (obj, type) {
        var defaultobj = {};
        if (obj) {
            merge(obj, defaultobj);
            if (type) {
                obj.type = type;
            }
            else {
                obj.type = "status";
            }
        }
        else {
            obj = this.system;
            merge(obj, defaultobj);
            obj.type = "status";
        }
        if (!obj._id) {
            obj._id = obj.type + "_" + this.serial;
        }
        objectessentials(obj, this.serial);
        return obj;
    };
    StoreApi.prototype.data = function (obj, uid) {
        if (!obj) {
            throw Error("missing object");
        }
        else if (!uid) {
            throw Error("missing uid");
        }
        objectessentials(obj, this.serial);
        if (!obj._id) {
            for (var i in this.components) {
                if (this.components[i].uid === uid) {
                    obj._id = this.components[i].type + "_" + uid + "_" + obj.updatedAt;
                }
            }
        }
        return obj;
    };
    StoreApi.prototype.new = function (uid) {
        var obj = {};
        objectessentials(obj, this.serial);
        for (var i in this.components) {
            if (this.components[i].uid === uid) {
                obj._id = this.components[i].type + "_" + uid + "_" + obj.updatedAt;
            }
        }
        return obj;
    };
    return StoreApi;
})();

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIl0sIm5hbWVzIjpbIlRpbWVOb3ciLCJvYmplY3Rlc3NlbnRpYWxzIiwiY29uc3RydWN0b3IiLCJzdGF0dXMiLCJkYXRhIiwibmV3Il0sIm1hcHBpbmdzIjoiQUFBQSxJQUFPLEtBQUssV0FBVyxVQUFVLENBQUMsQ0FBQztBQUNuQyxJQUFPLEdBQUcsV0FBVyxxQkFBcUIsQ0FBQyxDQUFDO0FBbUc1QztJQUNJQSxNQUFNQSxDQUFDQSxJQUFJQSxJQUFJQSxFQUFFQSxDQUFDQSxPQUFPQSxFQUFFQSxDQUFDQTtBQUNoQ0EsQ0FBQ0E7QUFFRCwwQkFBMEIsR0FBRyxFQUFFLE1BQU07SUFDakNDLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFNBQVNBLENBQUNBLENBQUNBLENBQUNBO1FBQ2pCQSxHQUFHQSxDQUFDQSxTQUFTQSxHQUFHQSxPQUFPQSxFQUFFQSxDQUFDQTtJQUM5QkEsQ0FBQ0E7SUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDZEEsR0FBR0EsQ0FBQ0EsTUFBTUEsR0FBR0EsTUFBTUEsQ0FBQ0E7SUFDeEJBLENBQUNBO0lBQ0RBLE1BQU1BLENBQUNBLEdBQUdBLENBQUNBO0FBQ2ZBLENBQUNBO0FBRUQsaUJBQVM7SUFNTCxrQkFBWSxVQUF5QixFQUFFLE1BQWMsRUFBRSxRQUFnQjtRQUh2RUMsZUFBVUEsR0FBa0JBLEVBQUVBLENBQUNBO1FBSzNCQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNkQSxNQUFNQSxLQUFLQSxDQUFDQSxnQkFBZ0JBLENBQUNBLENBQUNBO1FBQ2xDQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxFQUFFQSxDQUFDQSxDQUFDQSxDQUFDQSxNQUFNQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNqQkEsTUFBTUEsS0FBS0EsQ0FBQ0EsYUFBYUEsQ0FBQ0EsQ0FBQ0E7UUFD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QUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDNUJBLEVBQUVBLENBQUNBLENBQUNBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLEdBQUdBLEtBQUtBLEdBQUdBLENBQUNBLENBQUNBLENBQUNBO29CQUNqQ0EsR0FBR0EsQ0FBQ0EsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsSUFBSUEsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsR0FBR0EsQ0FBQ0EsU0FBU0EsQ0FBQ0E7Z0JBQ3hFQSxDQUFDQTtZQUNMQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVEQSxNQUFNQSxDQUFDQSxHQUFHQSxDQUFDQTtJQUVmQSxDQUFDQTtJQUVELHNCQUFHLEdBQUgsVUFBSSxHQUFXO1FBQ1hDLElBQUlBLEdBQUdBLEdBQVlBLEVBQUVBLENBQUNBO1FBQ3RCQSxnQkFBZ0JBLENBQUNBLEdBQUdBLEVBQUVBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBO1FBQ25DQSxHQUFHQSxDQUFDQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQSxJQUFJQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUM1QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsS0FBS0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7Z0JBQ2pDQSxHQUFHQSxDQUFDQSxHQUFHQSxHQUFHQSxJQUFJQSxDQUFDQSxVQUFVQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxJQUFJQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxHQUFHQSxDQUFDQSxTQUFTQSxDQUFDQTtZQUN4RUEsQ0FBQ0E7UUFDTEEsQ0FBQ0E7UUFDREEsTUFBTUEsQ0FBQ0EsR0FBR0EsQ0FBQ0E7SUFDZkEsQ0FBQ0E7SUFDTCxlQUFDO0FBQUQsQ0F6RlMsQUF5RlIsR0FBQSxDQUFBIiwiZmlsZSI6ImluZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1lcmdlID0gcmVxdWlyZShcImpzb24tYWRkXCIpO1xuaW1wb3J0IGxvcyA9IHJlcXVpcmUoXCJsaW51eC1vbmxpbmUtc3RhdHVzXCIpO1xuXG5cbmludGVyZmFjZSBBdWRpb0NoYW5uZWxBbnN3ZXIge1xuICAgIGRldjogc3RyaW5nO1xuICAgIGFjdGl2ZTogYm9vbGVhbjtcbn1cblxuaW50ZXJmYWNlIEF1ZGlvQW5zd2VyIHtcbiAgICBsYWJlbDogc3RyaW5nO1xuICAgIGRldjogc3RyaW5nO1xuICAgIHB1bHNlbmFtZTogc3RyaW5nO1xuICAgIGFjdGl2ZTogYm9vbGVhbjtcbiAgICBjaGFubmVsczogQXVkaW9DaGFubmVsQW5zd2VyW107XG59XG5cbmludGVyZmFjZSBWaWRlb0NoYW5uZWxBbnN3ZXIge1xuICAgIGRldjogc3RyaW5nO1xuICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgYWN0aXZlOiBib29sZWFuO1xufVxuXG5pbnRlcmZhY2UgVmlkZW9BbnN3ZXIge1xuICAgIGRldjogc3RyaW5nO1xuICAgIGxhYmVsOiBzdHJpbmc7XG4gICAgYWN0aXZlOiBib29sZWFuO1xuICAgIGNoYW5uZWxzOiBWaWRlb0NoYW5uZWxBbnN3ZXJbXTtcbiAgICBtb2RlbF9pZDogc3RyaW5nO1xuICAgIHZlbmRvcl9pZDogc3RyaW5nO1xuICAgIHJlc29sdXRpb246IHN0cmluZztcbiAgICBidXM6IHN0cmluZztcbiAgICBzZXJpYWw6IHN0cmluZztcbn1cblxuXG5pbnRlcmZhY2UgU2NhbkFuc3dlciB7XG4gICAgZXNzaWQ6IHN0cmluZztcbiAgICBtYWM6IHN0cmluZztcbiAgICBzaWduYWw6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIE5ldHdvcmtBbnN3ZXIge1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBtYWM6IHN0cmluZztcbiAgICBpbnRlcmZhY2U6IHN0cmluZztcbiAgICBlc3NpZD86IHN0cmluZztcbiAgICBzY2FuPzogU2NhbkFuc3dlcltdO1xuICAgIGlwPzogc3RyaW5nO1xuICAgIGdhdGV3YXk/OiBzdHJpbmc7XG59XG5cblxuXG5pbnRlcmZhY2UgTHN1c2JkZXZBbnN3ZXIge1xuICAgIGRldjogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbiAgICBodWI6IHN0cmluZztcbiAgICBwcm9kdWN0OiBzdHJpbmc7XG4gICAgaWQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIEdldERyaXZlc0Fuc3dlciB7XG4gICAgZmlsZXN5c3RlbTogc3RyaW5nO1xuICAgIGJsb2Nrczogc3RyaW5nO1xuICAgIHVzZWQ6IHN0cmluZztcbiAgICBhdmFpbGFibGU6IHN0cmluZztcbiAgICBjYXBhY2l0eTogc3RyaW5nO1xuICAgIG1vdW50ZWQ6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElPbmxpbmVBbnN3ZXIge1xuICAgIGJvb3RJZDogc3RyaW5nO1xuICAgIGJvb3RUaW1lOiBudW1iZXI7XG4gICAgdXBkYXRlZEF0OiBudW1iZXI7XG4gICAgdXNiRGV2aWNlczogTHN1c2JkZXZBbnN3ZXJbXTtcbiAgICBkcml2ZXM6IEdldERyaXZlc0Fuc3dlcltdO1xuICAgIG5ldHdvcmtzOiBOZXR3b3JrQW5zd2VyW107XG4gICAgdmlkZW86IHtcbiAgICAgICAgaW5wdXRzOiBWaWRlb0Fuc3dlcltdO1xuICAgIH07XG4gICAgYXVkaW86IHtcbiAgICAgICAgaW5wdXRzOiBBdWRpb0Fuc3dlcltdO1xuICAgIH07XG59XG5cblxuaW50ZXJmYWNlIElPYmplY3Qge1xuICAgIF9pZDogc3RyaW5nO1xuICAgIHVwZGF0ZWRBdDogc3RyaW5nO1xuICAgIHR5cGU6IHN0cmluZztcbn1cblxuaW50ZXJmYWNlIElDb21wb25lbnRzIHtcbiAgICB0eXBlOiBzdHJpbmc7XG4gICAgdWlkOiBzdHJpbmc7XG59XG5cblxuXG5mdW5jdGlvbiBUaW1lTm93KCkge1xuICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbn1cblxuZnVuY3Rpb24gb2JqZWN0ZXNzZW50aWFscyhvYmosIHNlcmlhbCkge1xuICAgIGlmICghb2JqLnVwZGF0ZWRBdCkge1xuICAgICAgICBvYmoudXBkYXRlZEF0ID0gVGltZU5vdygpO1xuICAgIH1cblxuICAgIGlmICghb2JqLnNlcmlhbCkge1xuICAgICAgICBvYmouc2VyaWFsID0gc2VyaWFsO1xuICAgIH1cbiAgICByZXR1cm4gb2JqO1xufVxuXG5leHBvcnQgPSBjbGFzcyBTdG9yZUFwaSB7XG4gICAgdGltZXpvbmU6IHN0cmluZztcbiAgICBzZXJpYWw6IHN0cmluZztcbiAgICBjb21wb25lbnRzOiBJQ29tcG9uZW50c1tdID0gW107XG4gICAgc3lzdGVtOiBJT25saW5lQW5zd2VyO1xuXG4gICAgY29uc3RydWN0b3IoY29tcG9uZW50czogSUNvbXBvbmVudHNbXSwgc2VyaWFsOiBzdHJpbmcsIHRpbWV6b25lOiBzdHJpbmcpIHtcblxuICAgICAgICBpZiAoIWNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwibWlzc2luZyBvYmplY3RcIik7XG4gICAgICAgIH0gZWxzZSBpZiAoIXNlcmlhbCkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJtaXNzaW5nIHVpZFwiKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXRpbWV6b25lKSB7XG4gICAgICAgICAgICB0aGlzLnRpbWV6b25lID0gXCJFdXJvcGUvTG9uZG9uXCI7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnRpbWV6b25lID0gdGltZXpvbmU7XG4gICAgICAgIH1cblxuXG4gICAgICAgIHRoaXMuc2VyaWFsID0gc2VyaWFsO1xuICAgICAgICB0aGlzLmNvbXBvbmVudHMgPSBjb21wb25lbnRzO1xuICAgICAgICBsZXQgc3lzID0gdGhpcy5zeXN0ZW07XG4gICAgICAgIGxvcygpLnRoZW4oZnVuY3Rpb24oZGF0YSkge1xuICAgICAgICAgICAgc3lzID0gZGF0YTtcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImxpbnV4LW9ubGluZS1zdGF0dXMgZXJyb3I6XCIsIGVycik7XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgc3RhdHVzKG9iaj86IGFueSwgdHlwZT86IHN0cmluZyk6IElPYmplY3Qge1xuICAgICAgICBsZXQgZGVmYXVsdG9iaiA9IDxJT2JqZWN0Pnt9O1xuXG4gICAgICAgIGlmIChvYmopIHtcbiAgICAgICAgICAgIG1lcmdlKG9iaiwgZGVmYXVsdG9iaik7XG4gICAgICAgICAgICBpZiAodHlwZSkge1xuICAgICAgICAgICAgICAgIG9iai50eXBlID0gdHlwZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgb2JqLnR5cGUgPSBcInN0YXR1c1wiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgb2JqID0gdGhpcy5zeXN0ZW07XG4gICAgICAgICAgICBtZXJnZShvYmosIGRlZmF1bHRvYmopO1xuICAgICAgICAgICAgb2JqLnR5cGUgPSBcInN0YXR1c1wiO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCFvYmouX2lkKSB7XG4gICAgICAgICAgICBvYmouX2lkID0gb2JqLnR5cGUgKyBcIl9cIiArIHRoaXMuc2VyaWFsO1xuICAgICAgICB9XG5cbiAgICAgICAgb2JqZWN0ZXNzZW50aWFscyhvYmosIHRoaXMuc2VyaWFsKTtcblxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cblxuXG4gICAgZGF0YShvYmo6IGFueSwgdWlkOiBzdHJpbmcpOiBJT2JqZWN0IHtcbiAgICAgICAgaWYgKCFvYmopIHtcbiAgICAgICAgICAgIHRocm93IEVycm9yKFwibWlzc2luZyBvYmplY3RcIik7XG4gICAgICAgIH0gZWxzZSBpZiAoIXVpZCkge1xuICAgICAgICAgICAgdGhyb3cgRXJyb3IoXCJtaXNzaW5nIHVpZFwiKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgb2JqZWN0ZXNzZW50aWFscyhvYmosIHRoaXMuc2VyaWFsKTtcblxuICAgICAgICBpZiAoIW9iai5faWQpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGkgaW4gdGhpcy5jb21wb25lbnRzKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50c1tpXS51aWQgPT09IHVpZCkge1xuICAgICAgICAgICAgICAgICAgICBvYmouX2lkID0gdGhpcy5jb21wb25lbnRzW2ldLnR5cGUgKyBcIl9cIiArIHVpZCArIFwiX1wiICsgb2JqLnVwZGF0ZWRBdDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gb2JqO1xuXG4gICAgfVxuXG4gICAgbmV3KHVpZDogc3RyaW5nKSB7XG4gICAgICAgIGxldCBvYmogPSA8SU9iamVjdD57fTtcbiAgICAgICAgb2JqZWN0ZXNzZW50aWFscyhvYmosIHRoaXMuc2VyaWFsKTtcbiAgICAgICAgZm9yIChsZXQgaSBpbiB0aGlzLmNvbXBvbmVudHMpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvbmVudHNbaV0udWlkID09PSB1aWQpIHtcbiAgICAgICAgICAgICAgICBvYmouX2lkID0gdGhpcy5jb21wb25lbnRzW2ldLnR5cGUgKyBcIl9cIiArIHVpZCArIFwiX1wiICsgb2JqLnVwZGF0ZWRBdDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gb2JqO1xuICAgIH1cbn1cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
